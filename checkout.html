
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout | WALLIFIED</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://js.stripe.com/v3/"></script>
    <link rel="stylesheet" href="/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@200;300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; }
    </style>
</head>
<body class="bg-white text-black antialiased" x-data="{
    cart: [],
    loading: false,
    shippingInfo: {
        email: '',
        name: '',
        address: '',
        city: '',
        pincode: '',
        phone: ''
    },
    init() {
        this.cart = getCart();
        if (this.cart.length === 0) window.location.href = '/shop.html';
    },
    calculateTotal() {
        return this.cart.reduce((total, item) => total + (item.price * item.quantity), 0);
    },
    async handleSubmit() {
        this.loading = true;
        // In a real scenario, you'd call your backend to create a Stripe Session
        // For this demo, we'll simulate the order creation in Supabase
        const { data, error } = await supabase.from('orders').insert([{
            customer_name: this.shippingInfo.name,
            customer_email: this.shippingInfo.email,
            shipping_address: this.shippingInfo.address,
            total_amount: this.calculateTotal(),
            items: this.cart,
            status: 'pending'
        }]);

        if (error) {
            alert('Error creating order. Please try again.');
            this.loading = false;
            return;
        }

        alert('Order placed successfully! (Demo Mode)');
        saveCart([]);
        window.location.href = '/index.html';
    }
}">

    <div id="announcement-container" class="fixed top-0 left-0 right-0 z-[110]"></div>
    <div id="header-container"></div>

    <main class="pt-[112px]">
        <section class="py-20">
            <div class="container mx-auto px-6">
                <h1 class="text-6xl md:text-8xl font-black uppercase tracking-tighter mb-20">Secure <br /> Checkout</h1>

                <div class="grid grid-cols-1 lg:grid-cols-12 gap-20">
                    <!-- Shipping Form -->
                    <div class="lg:col-span-7">
                        <form @submit.prevent="handleSubmit" class="space-y-12">
                            <div>
                                <h3 class="text-xl font-black uppercase tracking-widest mb-10 pb-6 border-b border-zinc-100">Contact Information</h3>
                                <div class="grid grid-cols-1 gap-6">
                                    <input type="email" x-model="shippingInfo.email" placeholder="EMAIL ADDRESS" required class="w-full bg-zinc-50 border-2 border-transparent focus:border-black p-6 font-bold text-xs uppercase tracking-widest outline-none transition-all">
                                    <input type="tel" x-model="shippingInfo.phone" placeholder="WHATSAPP NUMBER" required class="w-full bg-zinc-50 border-2 border-transparent focus:border-black p-6 font-bold text-xs uppercase tracking-widest outline-none transition-all">
                                </div>
                            </div>

                            <div>
                                <h3 class="text-xl font-black uppercase tracking-widest mb-10 pb-6 border-b border-zinc-100">Shipping Address</h3>
                                <div class="grid grid-cols-1 gap-6">
                                    <input type="text" x-model="shippingInfo.name" placeholder="FULL NAME" required class="w-full bg-zinc-50 border-2 border-transparent focus:border-black p-6 font-bold text-xs uppercase tracking-widest outline-none transition-all">
                                    <textarea x-model="shippingInfo.address" placeholder="FULL ADDRESS" required class="w-full bg-zinc-50 border-2 border-transparent focus:border-black p-6 font-bold text-xs uppercase tracking-widest outline-none transition-all h-32"></textarea>
                                    <div class="grid grid-cols-2 gap-6">
                                        <input type="text" x-model="shippingInfo.city" placeholder="CITY" required class="w-full bg-zinc-50 border-2 border-transparent focus:border-black p-6 font-bold text-xs uppercase tracking-widest outline-none transition-all">
                                        <input type="text" x-model="shippingInfo.pincode" placeholder="PINCODE" required class="w-full bg-zinc-50 border-2 border-transparent focus:border-black p-6 font-bold text-xs uppercase tracking-widest outline-none transition-all">
                                    </div>
                                </div>
                            </div>

                            <button 
                                type="submit" 
                                :disabled="loading"
                                class="w-full bg-black text-white py-8 font-black uppercase tracking-[0.3em] text-sm hover:bg-[#FF0000] transition-all flex items-center justify-center gap-4"
                            >
                                <span x-show="!loading">Pay ₹<span x-text="calculateTotal()"></span> Now</span>
                                <div x-show="loading" class="w-6 h-6 border-4 border-white border-t-transparent rounded-full animate-spin"></div>
                            </button>
                        </form>
                    </div>

                    <!-- Summary -->
                    <div class="lg:col-span-5">
                        <div class="bg-zinc-50 p-10">
                            <h3 class="text-xl font-black uppercase tracking-widest mb-10 pb-6 border-b border-zinc-200">Your Items</h3>
                            <div class="space-y-8 mb-10">
                                <template x-for="item in cart" :key="item.id">
                                    <div class="flex gap-6">
                                        <div class="w-20 aspect-[3/4] bg-zinc-100 shrink-0 shadow-md">
                                            <img :src="item.image" :alt="item.name" class="w-full h-full object-cover">
                                        </div>
                                        <div class="flex-grow">
                                            <h4 class="text-xs font-black uppercase tracking-tight" x-text="item.name"></h4>
                                            <p class="text-[10px] uppercase tracking-widest text-zinc-400" x-text="item.size + ' | ' + item.material"></p>
                                            <div class="flex justify-between items-center mt-2">
                                                <p class="text-[10px] font-black" x-text="'QTY: ' + item.quantity"></p>
                                                <p class="text-sm font-black" x-text="'₹' + (item.price * item.quantity)"></p>
                                            </div>
                                        </div>
                                    </div>
                                </template>
                            </div>
                            <div class="pt-6 border-t border-zinc-200 space-y-4">
                                <div class="flex justify-between text-xs font-bold uppercase tracking-widest">
                                    <span class="text-zinc-400">Subtotal</span>
                                    <span x-text="'₹' + calculateTotal()"></span>
                                </div>
                                <div class="flex justify-between text-xs font-bold uppercase tracking-widest">
                                    <span class="text-zinc-400">Shipping</span>
                                    <span class="text-green-600">FREE</span>
                                </div>
                                <div class="flex justify-between text-xl font-black uppercase tracking-tighter pt-4">
                                    <span>Total</span>
                                    <span x-text="'₹' + calculateTotal()"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <div id="footer-container"></div>

    <script src="/js/app.js"></script>
    <script src="/js/components.js"></script>
</body>
</html>
